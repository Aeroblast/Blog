#mode:tech
#title:ã€ä¸mongoDB .NET Driverç©è€ã€‘å°†BSONç®€å•åœ°è¾“å‡ºä¸ºèƒ½ç”¨çš„JSON
å‡†å¤‡åšä¸œè¥¿çš„æ—¶å€™ï¼Œéšä¾¿æŸ¥äº†æŸ¥è¡¨é¢çŸ¥è¯†ï¼Œç„¶åé€‰äº†mongoDBã€‚ç„¶åé©±åŠ¨è¯­è¨€ä¸Šï¼Œå’±æ˜¯çœŸçš„è®¨åŒç±»å‹ä¸æ¸…æ¥šçš„ä¸œè¥¿å†™é‡æ´»ï¼ŒJavaå’ŒC#äºŒé€‰ä¸€è‚¯å®šé€‰è‡ªå·±ç†Ÿæ‚‰çš„ï¼Œç»“æœèµ„æ–™å‡ºä¹é¢„æ–™åœ°å°‘â€¦â€¦

MongoDB.Driverå’ŒMongoDB.Bsonç‰ˆæœ¬2.13.1ã€‚

å…ˆæ”¾ç»“è®ºâ€¦â€¦

[code=cs]
using (var stringWriter = new StringWriter())
using (var jsonWriter = new JsonWriter(stringWriter, new JsonWriterSettings { OutputMode = JsonOutputMode.RelaxedExtendedJson }))
{
	jsonWriter.WriteStartDocument();
	jsonWriter.WriteName("success");
	jsonWriter.WriteBoolean(true);
	jsonWriter.WriteName("data");
	var c = BsonSerializationContext.CreateRoot(jsonWriter);
	collection.DocumentSerializer.Serialize(c, doc);
	jsonWriter.WriteEndDocument();
	var jsonString = stringWriter.ToString();
	await context.Response.WriteAsync(jsonString);
}
[/code]

æ–‡æ¡£çš„èŒƒä¾‹é‡Œæœ‰[link=https://mongodb.github.io/mongo-csharp-driver/2.13/examples/exporting_json/]åºåˆ—åŒ–çš„å†™æ³•[/link]ï¼ˆå…¶å®æ€»å…±ä¹Ÿæ²¡å¤šå°‘æ–‡ç« ï¼‰ã€‚
è€ŒJsonWriterçš„ç”¨æ³•è¿è’™å¸¦çŒœå¾ˆå¿«å°±ä¼šç”¨äº†ï¼ˆè¯´æ˜è¿™ä¸ªAPIè®¾è®¡å¾—ä¸é”™wwï¼‰ï¼Œäºæ˜¯åœ¨å‰ååŠ ç‚¹åˆ«çš„å†…å®¹ï¼ˆä½†æ˜¯è¦è‡ªå·±ç®—æ‹¬å·å¯¹åº”ï¼Œå®ƒä¸ä¼šå¸®ä½ éªŒè¯ï¼‰ã€‚
ç„¶è€Œï¼Œæ²¡æœ‰JsonWriterSettingsçš„è¯ï¼Œç»“æœé‡Œè¾“å‡ºObjectId("xxx")ä¹‹ç±»çš„ä¸œè¥¿åˆ°å‰ç«¯å°±ç›´æ¥æŠ¥é”™äº†ã€‚è®²é“ç†è¿™éƒ½ä¸æ˜¯åˆæ³•JSONï¼Œæ€ä¹ˆèƒ½é»˜è®¤è¾“å‡ºæ–¹è¨€â€¦â€¦äº‹å®ä¸Šå¦‚æœæ•°æ®é‡Œæ²¡å•¥BSONæ‹“å±•çš„ç©æ„ï¼Œç›´æ¥ToString()ä¹Ÿæ²¡å·®ã€‚

å…³é”®å°±æ˜¯è®¾å®šOutputModeï¼Œå‚æ•°æ˜¯ä¸ªEnumï¼Œå«JsonOutputModeï¼ˆ[link=https://mongodb.github.io/mongo-csharp-driver/2.13/apidocs/html/T_MongoDB_Bson_IO_JsonOutputMode.htm]ğŸ”—.NETé©±åŠ¨çš„APIæ–‡æ¡£[/link]ï¼‰ï¼Œå…¶ä¸­CanonicalExtendedJsonå’ŒRelaxedExtendedJsonéƒ½åº”è¯¥æ˜¯åˆæ³•JSONã€‚

è‡³äºè¿™ä¿©ä¸œè¥¿æ˜¯å•¥ï¼Œåœ¨mongoDBæ‰‹å†Œé‡Œæœ‰ï¼Œå«åš[link=https://docs.mongodb.com/manual/reference/mongodb-extended-json/]MongoDB Extended JSON[/link]ã€‚æ²¡é”™ï¼Œä¸æ˜¯é©±åŠ¨çš„æ–‡æ¡£ï¼Œæ˜¯æœ¬ä½“çš„æ–‡æ¡£ï¼Œå› ä¸ºè¿™ä¸ªJSONä¸åŒè¯­è¨€çš„é©±åŠ¨éƒ½åœ¨ç”¨â€¦â€¦

è¿™ä¹ˆä¸€çœ‹å…¶å®å¾ˆæ¸…æ¥šï¼Œä½†ä¸¤çœ¼ä¸€æŠ¹é»‘çš„æƒ…å†µä¸‹å»è°·æ­Œéƒ½ä¸çŸ¥é“ç”¨ä»€ä¹ˆå…³é”®è¯ï¼Œæœ€åè¿˜æ˜¯åœ¨æŸè‘—åé—®ç­”ç«™çœ‹åˆ°äº†æ­£è§£ï¼ˆè€Œä¸”OutputModeæ˜¯obsoleteçš„å€¼ï¼‰ã€‚
å¯¹äºç®€å•è¿æ¥å‰ç«¯å’Œæ•°æ®åº“çš„ç¨‹åºï¼Œæš‚æ—¶ä¸éœ€è¦æé‚£äº›åå°„ï¼Œè¿™ä¹ˆä¸€ä¸ªç®€å•çš„éœ€æ±‚çƒ¦æ¼å¥½ä¹…çœŸçš„é—¹å¿ƒï¼Œæ–°æ‰‹å‘çš„éœ€æ±‚å…¥ä¸äº†å¤§ä½¬çš„æ³•çœ¼å—â€¦â€¦
[time]20210930 14:57:30[/time]